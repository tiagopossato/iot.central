upstream test_server {  
    server 127.0.0.1:8000;
    keepalive 120;
}

server {
    listen 80 default_server;
    listen [::]:80 default_server;
	server_name _;
    
    # SSL configuration
    #
    listen 443 ssl default_server;
    listen [::]:443 ssl default_server;
    ssl_protocols   TLSv1.2;
    #
    # Self signed certs generated by the ssl-cert package

    ssl_certificate /etc/nginx/ssl/nginx.crt;
    ssl_certificate_key /etc/nginx/ssl/nginx.key;

    access_log  /opt/iot.central/log/nginx-access.log;
    error_log   /opt/iot.central/log/nginx-error.log warn;

    location /static/ {
        autoindex on;
        alias   /var/www/static/;
    }

    location /db.sqlite3{
        alias /home/pi/db.sqlite3;
    }

    location / {
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header Host $http_host;
        proxy_redirect off;

        if (!-f $request_filename) {
            proxy_pass http://test_server;
            break;
        }
    }

    #For favicon
    location  /favicon.ico {
        alias /opt/iot.central/central/favicon.ico;
    }

    #For robots.txt
    #location  /robots.txt {
    #    alias /var/www/seu_projeto/seu-projeto/static/robots.txt ;
    #}
    # Error pages
    #error_page 500 502 503 504 /500.html;
    #location = /500.html {
    #    root /var/www/seu_projeto/seu-projeto/static/;
    #}
}